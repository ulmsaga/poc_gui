package com.mobigen.cdev.datagw.module.test.service;

import com.mobigen.cdev.datagw.module.test.dto.EduBoardDto;
import com.mobigen.cdev.datagw.module.test.repository.ExceptionTestRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

@Service
public class ExceptionTestServiceImpl implements ExceptionTestService {

    private final ExceptionTestRepository exceptionTestRepository;

    @Autowired
    public ExceptionTestServiceImpl(ExceptionTestRepository exceptionTestRepository) {
        this.exceptionTestRepository = exceptionTestRepository;
    }

    @Override
    public List<EduBoardDto> getBoardList(Map<String, Object> param) {
        // -------------------------------------------------------------
        // 쿼리 오류 유발
        // mybatis-config.xml defaultStatementTimeout : 180 -> 1
        int unionCnt = 900;
        List<String> unionList = new ArrayList<>();
        for (int i=0; i<unionCnt; i++) {
            unionList.add("C" + String.valueOf(i));
        }
        param.put("unionList", unionList);
        // -------------------------------------------------------------
        return exceptionTestRepository.getBoardList(param);
    }

    @Override
    public List<EduBoardDto> getBoardListForTimeOut(Map<String, Object> param) {
        int unionCnt = 61;
        List<String> unionList = new ArrayList<>();
        for (int i=0; i<unionCnt; i++) {
            unionList.add("C" + String.valueOf(i));
        }
        param.put("unionList", unionList);
        return exceptionTestRepository.getBoardListForTimeOut(param);
    }

    @Override
    public List<EduBoardDto> getBoardListFromNoneTryCatchRuntimException(Map<String, Object> parma) {
        List<EduBoardDto> eduBoardDtoList = new ArrayList<>();

        List<String> list = new ArrayList<>();
        for (int i=0; i<list.size(); i++) {
            list.add("C" + String.valueOf(i));
        }

        String tmp = list.get(list.size()).trim();
        System.out.println("tmp = " + tmp);

        return eduBoardDtoList;
    }

    @Override
    public List<EduBoardDto> getBoardListFromRuntimException(Map<String, Object> parma) {
        return null;
    }
}
