package com.mobigen.cdev.datagw.module.datamanages.interfacesource.controller;

import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestPart;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.mobigen.cdev.datagw.core.base.dto.RsResultDto;
import com.mobigen.cdev.datagw.module.datamanages.interfacesource.dto.DataManageDetailDefDto;
import com.mobigen.cdev.datagw.module.datamanages.interfacesource.service.DataManageService;

@RestController
@RequestMapping("datamanages")
public class DataManageController {
  private final DataManageService dataManageService;

  @SuppressWarnings("unused")
	private final Logger logger = LoggerFactory.getLogger(this.getClass());
  
  public DataManageController(DataManageService dataManageService) {
    this.dataManageService = dataManageService;
  }

  @PostMapping(value = "/getDataMainList", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> getDataMainList(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();
		result.setRs(dataManageService.getDataMainList(param));
		return ResponseEntity.ok(result);
	}
  
  @PostMapping(value = "/getDataDetailList", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> getDataDetailList(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();

		DataManageDetailDefDto detailDef = new DataManageDetailDefDto();
		detailDef.setSourceInfo(dataManageService.getDataDetailList(param));
		detailDef.setInterfaceTopicList(dataManageService.getInterfaceTopicList(param));
		detailDef.setInterfaceFileList(dataManageService.getInterfaceAddedFileList(param));

		result.setRs(detailDef);
		return ResponseEntity.ok(result);
	}

	@PostMapping(value = "/getDataMainJsonPropertyList", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> getDataMainJsonPropertyList(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();
		result.setRs(dataManageService.getDataMainJsonPropertyList(param));
		return ResponseEntity.ok(result);
	}

	@PostMapping(value = "/getDataDetailJsonPropertyList", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> getDataDetailJsonPropertyList(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();
		result.setRs(dataManageService.getDataDetailJsonPropertyList(param));
		return ResponseEntity.ok(result);
	}

	@PostMapping(value = "/regDataInfo", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> regDataInfo(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();
		result.setRs(dataManageService.regDataInfo(param, request, response));
		return ResponseEntity.ok(result);
	}

	@SuppressWarnings("unchecked")
	@PostMapping(value = "/regDataInfoMultiPartForm", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> regDataInfoMultiPartForm(
      String interfaceType,
      String applyType,
			@RequestPart(value = "interfaceInfo") Map<String, Object> interfaceInfo,
			@RequestPart(value = "dataSourceInfo") Map<String, Object> dataSourceInfo,
			@RequestPart(value = "deletedInterfaceTopicInfo") Map<String, Object> deletedInterfaceTopicInfo,
			@RequestPart(value = "addedInterfaceTopicInfo") Map<String, Object> addedInterfaceTopicInfo,
			@RequestPart(value = "deletedInterfaceFileInfo") Map<String, Object> deletedInterfaceFileInfo,
			@RequestPart(value = "addedInterfaceFileInfo") Map<String, Object> addedInterfaceFileInfo,
			MultipartFile[] files,
			HttpServletRequest request,
			HttpServletResponse response) {
		RsResultDto result = new RsResultDto();

		Map<String, Object> paramInterface = (Map<String, Object>) interfaceInfo;
		List<Map<String, Object>> paramDataSourceList = (List<Map<String, Object>>) dataSourceInfo.get("list");
		List<Map<String, Object>> paramDelTopicList = (List<Map<String, Object>>) deletedInterfaceTopicInfo.get("list");
		List<Map<String, Object>> paramAddTopicList = (List<Map<String, Object>>) addedInterfaceTopicInfo.get("list");
		List<Map<String, Object>> paramDelFileList = (List<Map<String, Object>>) deletedInterfaceFileInfo.get("list");
		List<Map<String, Object>> paramAddFileList = (List<Map<String, Object>>) addedInterfaceFileInfo.get("list");
		
		result.setRs(dataManageService.regDataInfoWithAddedFiles(interfaceType, applyType, paramInterface, paramDataSourceList, paramDelTopicList, paramAddTopicList, paramDelFileList, paramAddFileList, files, request, response));
		return ResponseEntity.ok(result);
	}

	@PostMapping(value = "/getCloudList", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> getCloudList(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();
		result.setRs(dataManageService.getCloudList(param));
		return ResponseEntity.ok(result);
	}

	@PostMapping(value = "/updateInterfaceUseYn", produces = MediaType.APPLICATION_JSON_VALUE)
	public ResponseEntity<RsResultDto> updateInterfaceUseYn(@RequestBody Map<String, Object> param, HttpServletRequest request, HttpServletResponse response) {
		RsResultDto result = new RsResultDto();
		result.setRs(dataManageService.updateInterfaceUseYn(param, request, response));
		return ResponseEntity.ok(result);
	}
  
}
