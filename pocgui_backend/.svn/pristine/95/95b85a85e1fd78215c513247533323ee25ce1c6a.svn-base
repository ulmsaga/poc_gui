package com.mobigen.cdev.datagw.module.collect.history.repository.mybatis;

import java.util.List;
import java.util.Map;

import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.stereotype.Repository;

import com.mobigen.cdev.datagw.core.file.excel.handler.ExcelDefaultExceptionHandler;
import com.mobigen.cdev.datagw.module.collect.history.dto.HistoryDto;
import com.mobigen.cdev.datagw.module.collect.history.dto.RetryCountDto;
import com.mobigen.cdev.datagw.module.collect.history.dto.RetryDto;
import com.mobigen.cdev.datagw.module.collect.history.dto.CompleteEventDto;
import com.mobigen.cdev.datagw.module.collect.history.dto.RetryIdDto;

@Repository
public class CollectHistoryRepositoryImpl implements CollectHistoryRepository {
  
  private final SqlSessionTemplate sqlSessionTemplateCollect;
  @SuppressWarnings({"unused"})
  private final SqlSessionTemplate sqlSessionTemplateGuiweb;
  private final String namespace = "com.mobigen.cdev.mapper.mysql.module.collect.history";

  public CollectHistoryRepositoryImpl(SqlSessionTemplate sqlSessionTemplateCollect, SqlSessionTemplate sqlSessionTemplateGuiweb) {
    this.sqlSessionTemplateCollect = sqlSessionTemplateCollect;
    this.sqlSessionTemplateGuiweb = sqlSessionTemplateGuiweb;
  } 
  
  @Override
  public List<HistoryDto> getHistoryList(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectList(namespace + ".getHistoryList", param);
  }

  @Override
  public void getHistoryListExcel(Map<String, Object> param, ExcelDefaultExceptionHandler rh) {
    sqlSessionTemplateCollect.select(namespace + ".getHistoryListExcel", param, rh);
  }

  @Override
  public int getNotFinishedRetryCount(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectOne(namespace + ".getNotFinishedRetryCount", param);
  }

  @Override
  public RetryCountDto getRetryCount(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectOne(namespace + ".getRetryCount", param);
  }

  @Override
  public int insertRetry(Map<String, Object> param) {
    return sqlSessionTemplateCollect.insert(namespace + ".insertRetry", param);
  }

  @Override
  public int updateHistForRetry(Map<String, Object> param) {
    return sqlSessionTemplateCollect.update(namespace + ".updateHistForRetry", param);
  }

  @Override
  public int updateRetryForceTerminate(Map<String, Object> param) {
    return sqlSessionTemplateCollect.update(namespace + ".updateRetryForceTerminate", param);
  }

  @Override
  public List<RetryDto> getRetryHistoryList(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectList(namespace + ".getRetryHistoryList", param);
  }

  @Override
  public List<RetryIdDto> getNotFinishedRetryLongTermOrTerminated(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectList(namespace + ".getNotFinishedRetryLongTermOrTerminated", param);
  }

  @Override
  public List<RetryIdDto> getNotFinishedRetryIdList(Map<String, Object> param) {
    param.put("notFinishedCheckLastMin", RetryIdDto.NOT_FINISHED_CHECK_LAST_MIN);
    return sqlSessionTemplateCollect.selectList(namespace + ".getNotFinishedRetryIdList", param);
  }
  @Override
  public List<RetryIdDto> getFinishedRetryIdList(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectList(namespace + ".getFinishedRetryIdList", param);
  }
  @Override
  public List<CompleteEventDto> getFinishedRetryEventList(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectList(namespace + ".getFinishedRetryEventList", param);
  }

  @Override
  public String getHistoryStatusTime(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectOne(namespace + ".getHistoryStatusTime", param);
  }

  @Override
  public List<CompleteEventDto> getHistoryListByHistId(Map<String, Object> param) {
    return sqlSessionTemplateCollect.selectList(namespace + ".getHistoryListByHistId", param);
  }


}
