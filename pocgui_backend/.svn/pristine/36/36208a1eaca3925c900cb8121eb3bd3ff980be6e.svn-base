package com.mobigen.cdev.datagw.module.datamanages.nmsinfo.service;

import java.util.List;
import java.util.Map;

import org.springframework.stereotype.Service;

import com.mobigen.cdev.datagw.core.exception.RsRuntimeException;
import com.mobigen.cdev.datagw.core.file.dto.ExcelDto;
import com.mobigen.cdev.datagw.core.file.excel.handler.ExcelDefaultExceptionHandler;
import com.mobigen.cdev.datagw.module.datamanages.nmsinfo.dto.UserInfoManageDto;
import com.mobigen.cdev.datagw.module.datamanages.nmsinfo.repository.mybatis.UserInfoManageRepository;

@Service
public class UserInfoManageServiceImpl implements UserInfoManageService{
  
  private final UserInfoManageRepository userInfoManageRepository;

  public UserInfoManageServiceImpl(UserInfoManageRepository userInfoManageRepository) {
    this.userInfoManageRepository = userInfoManageRepository;
  }

  @Override
  public List<UserInfoManageDto> getUserInfoList(Map<String, Object> param) {
    return userInfoManageRepository.getUserInfoList(param);
  }

  @Override
  public ExcelDto getUserInfoListExcel(Map<String, Object> param) {
    ExcelDto excelDto = new ExcelDto();

    try {
      ExcelDefaultExceptionHandler resultHandler = new ExcelDefaultExceptionHandler(param);
      userInfoManageRepository.getUserInfoListExcel(param, resultHandler);

      if("".equals(String.valueOf(param.get("sheetName")))) param.put("sheetName", "sheet1");
      if("".equals(String.valueOf(param.get("fileName")))) param.put("fileName", param.get("sheetName"));
      if("".equals(String.valueOf(param.get("fileExt")))) param.put("fileExt", "xlsx");

      excelDto.setFile_ext(String.valueOf(param.get("fileExt")));
      excelDto.setFile_name(String.valueOf(param.get("fileName")));
      excelDto.setTarget_file_path(resultHandler.execute());
    } catch (Exception e) {
      throw new RsRuntimeException("error.common.excel.file");
    }

    return excelDto;
  }
}
