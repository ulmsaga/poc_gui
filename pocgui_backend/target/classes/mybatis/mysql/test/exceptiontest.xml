<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mobigen.cdev.mapper.mysql.test">
    <select id="getBoardList" resultType="com.mobigen.cdev.poc.module.test.dto.EduBoardDto" parameterType="map">
        SELECT
            board_id
        ,	title
        ,	contents
        ,	reg_date
        ,	user_id
        ,   user_name
        ,	del_yn
        ,	read_cnt
        ,   item
        ,   @rownum:=@rownum+1 row_num
        FROM
            (
                <foreach collection="unionList" index="index" item="item" separator="UNION" open="" close="">
                    <include refid="sqlBoardList"/>
                </foreach>
            ) A
        ,   (
                SELECT @rownum:=0
            ) B
    </select>
    <sql id="sqlBoardList">
        SELECT
            board_id
        ,	title
        ,	contents
        ,	DATE_FORMAT(reg_date, '%Y-%m-%d %H:%i:%s') reg_date
        ,	A.user_id
        ,   B.user_name
        ,	del_yn
        ,	read_cnt
        ,   #{item} item
        FROM
            EDU_BOARD_TEST A LEFT OUTER JOIN
            EDU_USER B
            ON (A.user_id = B.user_id)
        WHERE 1 = 1
    </sql>

    <select id="getBoardListForTimeOut" resultType="com.mobigen.cdev.poc.module.test.dto.EduBoardDto" parameterType="map">
        SELECT
            user_id
        ,   user_name
        ,   @rownum:=@rownum+1 row_num
        FROM
        (
            <include refid="sqlBoardListForTimeOut"/>
        ) A
        ,
        (
        	SELECT @rownum:=0
        ) B
    </select>
    <sql id="sqlBoardListForTimeOut">
        SELECT
        	C0.user_id
        ,   '' user_name
        FROM
            <foreach collection="unionList" index="index" item="item" separator="," open="" close="">
                CM_SMS_AUTHONTICATION ${item}
            </foreach>
        WHERE 1 = 1
    </sql>
</mapper>